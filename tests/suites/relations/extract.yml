name: data connector
testcases:

- name: extract relations
  steps:
    # Clean working directory
    - script: rm -f *
    - script: lino dataconnector add source postgresql://postgres:sakila@source:5432/postgres?sslmode=disable
    - script: lino relation extract source
      assertions:
        - result.code ShouldEqual 0
        - result.systemout ShouldEqual "lino finds 40 relations from constraints"
        - result.systemerr ShouldBeEmpty

- name: extract relations with schema
  steps:
    # Clean working directory
    - script: rm -f *
    - script: lino dataconnector add --schema public source postgresql://postgres:sakila@source:5432/postgres?sslmode=disable
    - script: lino relation extract source
      assertions:
        - result.code ShouldEqual 0
        - result.systemout ShouldEqual "lino finds 40 relations from constraints"
        - result.systemerr ShouldBeEmpty

- name: extract relations with unknow schema
  steps:
    # Clean working directory
    - script: rm -f *
    - script: lino dataconnector add source --schema unkown postgresql://postgres:sakila@source:5432/postgres?sslmode=disable
    - script: lino relation extract  source
      assertions:
        - result.code ShouldEqual 0
        - result.systemout ShouldEqual "lino finds 0 relations from constraints"
        - result.systemerr ShouldBeEmpty